Bootstrap: docker
From: ubuntu:18.04

%post
# Disable apt interactive mode
export DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true

# Sync apt, install locales and tzdata
apt update; apt install -y tzdata locales

# Setting locale
printf 'en_GB ISO-8859-1%b\nen_GB.UTF-8 UTF-8' > /etc/locale.gen; locale-gen
printf 'tzdata tzdata/Areas select Europe%b\ntzdata tzdata/Zones/Europe select London' > /tmp/tzdata
debconf-set-selections /tmp/tzdata

# Installing dev enviornment related packages
apt install -y libharfbuzz0b \
libharfbuzz-dev \
gcc-8 \
g++-8 \
make \
libcurl4-openssl-dev \
libxml2-dev \
libssl-dev \
gfortran \
libreadline-dev \
libpng-dev \
libjpeg-dev \
libcairo2-dev \
xvfb \
libbz2-dev \
libzstd-dev \
liblzma-dev \
texinfo \
texlive \
texlive-fonts-extra \
wget \
libpcre2-dev \
libboost-all-dev \
libfftw3-dev \
libtiff5-dev

# Enabling GCC8 as default compiler
update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 700 --slave /usr/bin/g++ g++ /usr/bin/g++-7
update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-8 800 --slave /usr/bin/g++ g++ /usr/bin/g++-8

# Downloading and extracting R
wget --no-check-certificate https://cloud.r-project.org/src/base/R-4/R-4.0.3.tar.gz
tar -xvf R-4.0.3.tar.gz

# Compiling R
cd R-4.0.3
./configure --prefix='/usr/local' --enable-R-shlib --without-recommended-packages --with-x=no
make -j2
make install

%runscript
echo 'In order to map the host R library catalog and doc directories run:'
echo 'singularity shell --bind /host/actual/R/library:/usr/local/lib/R/library --bind /host/actual/R/doc:/usr/local/lib/R/doc containername.sif'

%labels
    Author Pietro Sammarco
    Version 1.1
    ReleaseDate 19.04.2022

%help
    Ubuntu 18.04 dev builder featuring R/4.0.3, boost 1.65 and GCC8.
